= BBB SportsPress Sync
:author: Oliver-Marcus Eder
:url-repo: https://github.com/OliEder/bbb-sportspress-sync
:url-tables: https://github.com/OliEder/bbb-live-tables
:url-bbb: https://www.basketball-bund.net
:icons: font
:toc: macro
:toclevels: 2

Synchronisiert Vereinsdaten aus der {url-bbb}[basketball-bund.net] REST API in SportsPress â€“ Teams, Spielplan, Ergebnisse, Spieler, Statistiken und Spielorte.

image::https://img.shields.io/badge/WordPress-6.0+-blue?logo=wordpress[WordPress]
image::https://img.shields.io/badge/PHP-8.1+-purple?logo=php[PHP]
image::https://img.shields.io/badge/Lizenz-GPL--2.0+-green[License]
image::https://img.shields.io/badge/Version-1.0.0-orange[Version]

toc::[]

== Features

* **Team-Discovery** â€“ Eigene Teams automatisch Ã¼ber Club-ID erkennen und registrieren
* **Team-Sync** â€“ Mannschaften (eigene + Gegner) mit Logos, Altersklasse/Geschlecht und Metadaten
* **Event-Sync** â€“ Spielplan, Ergebnisse, Status (abgesagt, Verzicht, unbestÃ¤tigt)
* **Liga-Spielplan** â€“ Alle Spiele einer Liga, nicht nur eigene Begegnungen
* **Venue-Sync** â€“ Spielfelder mit Adressen und Geocoding (Nominatim/OSM)
* **Spieler-Import** â€“ Boxscore-Statistiken mit konfigurierbarem Filter (nur eigene / alle Teams)
* **Reconciliation** â€“ Verschwundene Spiele werden automatisch entfernt
* **WP-Cron** â€“ Konfigurierbarer Auto-Sync (Standard: alle 6 Stunden)
* **Datenschutz** â€“ Manuelle SP-Ã„nderungen werden bei Updates nie Ã¼berschrieben
* **BBB Live Tables Integration** â€“ Speist SP-Daten (Logos, Links, Farben) via Filter Hooks in {url-tables}[BBB Live Tables] ein

== FÃ¼r wen?

FÃ¼r deutsche Basketballvereine, die SportsPress fÃ¼r ihre Website nutzen und den Spielplan, Ergebnisse und Statistiken automatisch aus basketball-bund.net importieren mÃ¶chten â€“ statt alles manuell zu pflegen.


== Voraussetzungen

* WordPress â‰¥ 6.0
* PHP â‰¥ 8.1 (empfohlen: 8.3, *nicht* 8.5 â€“ SportsPress Pro + Goodlayers crashen)
* https://www.themeboy.com/sportspress/[SportsPress] oder SportsPress Pro
* {url-tables}[BBB Live Tables] â€“ fÃ¼r Liga-Tabellen und Turnier-Brackets

IMPORTANT: Ohne BBB Live Tables fehlen Liga-Tabellen und Turnier-Brackets. SportsPress bringt eigene Tabellen mit, diese benÃ¶tigen aber vollstÃ¤ndige Ergebnisse aller Liga-Teams.


== Installation

=== Manuell (ZIP)

. {url-tables}/releases[BBB Live Tables] installieren und aktivieren
. ZIP-Datei von der {url-repo}/releases[Releases-Seite] herunterladen
. WordPress Admin â†’ Plugins â†’ Installieren â†’ Plugin hochladen â†’ ZIP auswÃ¤hlen
. Plugin aktivieren

=== Via Git

[source,bash]
----
cd wp-content/plugins/
git clone https://github.com/OliEder/bbb-live-tables.git
git clone https://github.com/OliEder/bbb-sportspress-sync.git
----

Beide Plugins im WordPress-Admin aktivieren.


== Schnellstart

Nach der Aktivierung: **SportsPress â†’ BBB Sync**

. **Einstellungen-Tab:** Club-ID eintragen (z.B. `4468`) +
  _(URL deiner Vereinsseite: `basketball-bund.net/club/id/XXXX`)_
. **Team-Discovery-Tab:** "Teams erkennen" klicken â†’ eigene Teams mit HÃ¤kchen aktivieren â†’ Speichern
. **Dashboard-Tab:** "Jetzt synchronisieren" klicken
. Fertig! Teams, Spielplan, Ergebnisse und Venues sind in SportsPress.


== Admin-OberflÃ¤che

Die Verwaltung erfolgt unter **SportsPress â†’ BBB Sync** mit vier Tabs.

=== Dashboard

Status-Ãœbersicht: Club-ID, registrierte Teams, Spieler-Import-Modus, letzter Sync mit Statistik. Manueller Sync-Button mit AJAX-Fortschrittsanzeige. Shortcode-Referenzkarte fÃ¼r BBB Live Tables.

=== Team-Discovery

Teams per Club-ID aus der BBB-API erkennen. Einzeln aktivierbar/deaktivierbar. Neue Teams mit ğŸ†•, bereits registrierte mit âœ… markiert.

=== Einstellungen

[cols="1,1,3",options="header"]
|===
| Einstellung | Default | Beschreibung

| Club-ID | â€“ | BBB-Vereins-ID (Pflichtfeld)
| Zeitraum (Tage) | 365 | Sync-Horizont (30â€“730)
| Auto-Sync (h) | 6 | Cron-Intervall (1â€“168)
| Spieler aus Boxscore | Aus | Spieler-Import aktivieren
| Nur eigene Spieler | An | Nur Spieler eigener Teams importieren (DSGVO-empfohlen)
|===

==== Wartung

* **Tabellen-Cache leeren** â€“ Alle Live-Tabellen- und Bracket-Caches lÃ¶schen
* **Boxscore-Flags reset** â€“ Spieler-Statistiken beim nÃ¤chsten Sync neu importieren
* **Sync-Lock lÃ¶sen** â€“ Verklemmten Sync-Lock aufheben

=== Logs

Filterbares Log (Alle / Fehler / Warnungen / Info) mit farblicher Hervorhebung.


== Sync-Architektur

=== Drei-Phasen-Sync

**Phase 1: Team-Discovery** (manuell, 1â€“2x pro Saison) +
Club-ID â†’ BBB-API â†’ Eigene Teams identifizieren â†’ In Admin auswÃ¤hlen

**Phase 2: Match-Sync** (automatisch, pro eigenem Team) +
Matches laden â†’ SP-Teams anlegen â†’ SP-Events anlegen â†’ Venues geocoden â†’ Spieler importieren â†’ Reconciliation

**Phase 3: Liga-Spielplan** (automatisch, pro Liga) +
Alle Matches einer Liga laden â†’ Auch Spiele ohne eigene Beteiligung â†’ SP-Table Post anlegen

=== Datenmodell-Mapping

[cols="1,1,2",options="header"]
|===
| BBB Entity | SportsPress | PrimÃ¤rer Key

| Team | `sp_team` | `_bbb_team_permanent_id`
| Match | `sp_event` | `_bbb_match_id`
| Spieler | `sp_player` | `_bbb_person_id`
| Liga | `sp_league` (Tax) | `_bbb_liga_id`
| Saison | `sp_season` (Tax) | Slug: `2025-2026`
| Spielfeld | `sp_venue` (Tax) | `_bbb_spielfeld_id`
| Tabelle | `sp_table` | `_bbb_liga_id`
|===

=== Datenschutz bei Updates

[cols="1,2",options="header"]
|===
| Was | Verhalten

| Post-Titel | Nur bei Erstanlage/Adoption. NIE bei Update Ã¼berschrieben.
| Post-Content | NIE Ã¼berschrieben.
| SP-Meta (`sp_abbreviation`, `sp_number`) | Nur wenn aktuell leer.
| BBB-Meta (`_bbb_*`) | Immer aktualisiert (IDs + Zuordnungen).
| Post-Autor | Nur wenn Autor = Sync-User. Manuelle Edits bleiben.
|===


== Spieler-Import

Boxscore-Statistiken von abgeschlossenen Spielen. Aktivierung unter Einstellungen.

=== Stat-Mapping

[cols="1,1,2",options="header"]
|===
| BBB | SportsPress | Beschreibung

| `pts` | `pts` | Punkte
| `ro` / `rd` / `rt` | `oreb` / `dreb` / `reb` | Rebounds
| `as` | `ast` | Assists
| `st` / `to` / `bs` | `stl` / `to` / `blk` | Steals, Turnovers, Blocks
| `fouls` | `pf` | Fouls
| `eff` | `eff` | Effizienz
| `esz` | `min` | Einsatzzeit
| `wt` / `twoPoints` / `threePoints` / `onePoints` | `fgm/fga` / `twom/twoa` / `3pm/3pa` / `ftm/fta` | Wurfstatistiken
|===

Anonymisierte Spieler (`playerId: 0`, hÃ¤ufig bei U8â€“U14) werden Ã¼bersprungen.

=== Meta-Boxen

FÃ¼r manuelle Zuordnung ohne vorherigen Sync stehen Meta-Boxen bereit:

* **sp_player** Edit-Screen: `_bbb_person_id` (BBB Person-ID)
* **sp_team** Edit-Screen: `_bbb_team_permanent_id` (BBB Team Permanent-ID)


== BBB Live Tables Integration

Wenn {url-tables}[BBB Live Tables] aktiv ist, registriert das Sync-Plugin automatisch 6 Filter Hooks:

[cols="2,3",options="header"]
|===
| Filter | Was das Sync-Plugin liefert

| `bbb_table_team_logo_url` | SP Featured Image statt BBB-API-Logo
| `bbb_table_team_url` | Klickbarer Link zum SP-Team-Profil
| `bbb_table_event_url` | Klickbarer Link zum SP-Event
| `bbb_table_theme_colors` | Farben aus SportsPress Frontend CSS
| `bbb_table_own_team_ids` | Eigene Teams aus SP-Meta
| `bbb_table_liga_options` | Liga-Dropdown im Editor aus `sp_league`
|===

Keine Konfiguration nÃ¶tig â€“ die Integration erfolgt automatisch.


== Projektstruktur

[source]
----
bbb-sportspress-sync/
â”œâ”€â”€ bbb-sportspress-sync.php              # Plugin-Bootstrap
â”œâ”€â”€ includes/
â”‚   â”œâ”€â”€ class-bbb-api-client.php           # BBB REST API Client
â”‚   â”œâ”€â”€ class-bbb-sync-engine.php          # Kern: Discovery + Sync + Reconciliation
â”‚   â”œâ”€â”€ class-bbb-player-sync.php          # Spieler-Import aus Boxscore
â”‚   â”œâ”€â”€ class-bbb-logo-handler.php         # Team-Logo Download + WP Media Library
â”‚   â”œâ”€â”€ class-bbb-cron.php                 # WP-Cron Handler
â”‚   â”œâ”€â”€ class-bbb-admin-page.php           # Admin UI (4 Tabs)
â”‚   â”œâ”€â”€ class-bbb-tables-integration.php   # Filter-Callbacks fÃ¼r BBB Live Tables
â”‚   â””â”€â”€ class-bbb-goodlayers-bracket.php   # Goodlayers PB Elemente (SP-angereichert)
â””â”€â”€ docs/
    â””â”€â”€ arc42-bbb-sportspress-sync.adoc    # Architekturdokumentation
----


== Entwicklung

=== Lokales Setup (Docker)

[source,bash]
----
cd Basketball-Apps/wp-local/
docker compose up -d
./setup.sh
----

WordPress unter `http://localhost:8080` (Login: admin/admin). +
Beide Plugins werden automatisch per Volume-Mount eingebunden.


== Bekannte EinschrÃ¤nkungen

* **PHP 8.5:** SportsPress Pro + Goodlayers crashen. PHP 8.3 verwenden.
* **Goodlayers Page Builder:** Rendert SP-BlÃ¶cke/Widgets nicht korrekt â€“ Shortcodes nutzen.
* **Mini-Liga Boxscore:** U8â€“U12 haben selten digitale AnschreibebÃ¶gen.
* **Anonymisierte Spieler:** `playerId: 0` bei U8â€“U14 â†’ werden nicht angelegt.
* **Venue Mini-Liga:** Nur Ortsname (String), keine strukturierte Adresse.


== Lizenz

Dieses Plugin ist lizenziert unter der https://www.gnu.org/licenses/gpl-2.0.html[GPL-2.0+].


== Autor

Entwickelt von https://github.com/OliEder[Oliver-Marcus Eder] â€“ Basketballtrainer und Softwareentwickler aus der Oberpfalz, Bayern.

Wenn dir das Plugin nÃ¼tzt, freue ich mich Ã¼ber einen Kaffee:

* â˜• https://buymeacoffee.com/olivermarcus.eder[Buy Me a Coffee]
* ğŸ https://ko-fi.com/olieder[Ko-fi]
